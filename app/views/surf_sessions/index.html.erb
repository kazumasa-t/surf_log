<%# ========================================= %>
<%# surf_sessions#index                       %>
<%# 自分用（ログイン済み）カレンダー画面     %>
<%# ========================================= %>

<%# ------------------------------ %>
<%# 表示対象の月を決定             %>
<%# ------------------------------ %>
<% base_date =
     params[:start_date].present? ?
       Date.parse(params[:start_date]) :
       Date.current.beginning_of_month
%>

<% month_range = base_date.beginning_of_month..base_date.end_of_month %>

<%# ------------------------------ %>
<%# 今月のサーフセッション集計     %>
<%# ------------------------------ %>
<% month_sessions =
     current_user.surf_sessions.where(session_date: month_range)
%>

<% total_minutes = month_sessions.sum(:duration_minutes).to_i %>
<% total_hours   = (total_minutes / 60.0).round(1) %>
<% total_days    = month_sessions.count %>

<%# ------------------------------ %>
<%# カレンダー部品を呼び出す       %>
<%# editable: true → 編集・遷移あり %>
<%# ------------------------------ %>
<%= render "calendar",
    base_date: base_date,
    total_hours: total_hours,
    total_days: total_days,
    streak_days: @streak_days,
    sessions_by_date: @sessions_by_date,
    editable: true
%>
